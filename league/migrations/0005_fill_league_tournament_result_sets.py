# -*- coding: utf-8 -*-
# Generated by Django 1.10.6 on 2017-05-30 21:01
from __future__ import unicode_literals

from django.db import migrations


def copy_data(apps, schema_editor):
    for league in apps.get_model("league.League").objects.all():
        lts_a = apps.get_model("league.LeagueTournamentSet").objects.create(dict(
            name=u'Категория A',
            number=16,
            datetime=league.tournament_a_datetime,
            is_filled=league.is_tournament_data_filled,
        ))
        lts_b = apps.get_model("league.LeagueTournamentSet").objects.create(dict(
            name=u'Категория B',
            datetime=league.tournament_b_datetime,
            is_filled=league.is_tournament_data_filled,
        ))
        for lc in league.leaguecompetitor_set.all():
            lts = None
            if lc.tournament_category == 'A':
                lts = lts_a
            elif lc.tournament_category == 'B':
                lts = lts_b
            if lts:
                apps.get_model("league.LeagueTournamentResult").objects.create(
                    dict(place=lc.tournament_place,
                         is_participant=lc.is_participant,
                         competitor=lc,
                         tournament_set=lts,
                         ))


class Migration(migrations.Migration):

    dependencies = [
        ('league', '0004_add_league_tournament_set'),
    ]

    operations = [
        migrations.RunPython(copy_data),
    ]
